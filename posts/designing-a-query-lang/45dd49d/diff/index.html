<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#333333" />
  <title>blog</title>
  <style>
  html { font-size: 16px; }
  body {
    font-family: Courier;
    font-size: 1em;
    line-height: 1.2em;
    padding: 20px;
    background: #fcfcfc;
    color: #333;
    max-width: 700px;
    margin: 0 auto;
    box-sizing: content-box;
    word-wrap: break-word;
  }
  h1 { font-size: 2em; line-height: 1em; font-weight: bold; }
  li { margin: 1em 0; }
  .title a {
    font-size: 2.5em;
    line-height: 1em;
    font-weight: bold;
    color: inherit;
  }
  .description {
    font-size: 0.9em;
    font-style: italic;
    line-height: 0.3em;
    margin-bottom: 20px;
  }
  pre {
    border: 1px solid #ccc;
    border-radius: 5px;
    padding: 15px;
    background: #f0f0f0;
    overflow: scroll;
    font-family: Courier;
    font-size: 1em;
  }
  pre code {
    padding: 0;
  }
  code {
    font-family: Courier;
    font-size: 1em;
    background: #f0f0f0;
    padding: 3px 5px;
  }
  blockquote {
    border-left: 5px solid #ddd;
    padding-left: 20px;
    margin: 40px 10px;
    font-style: italic;
  }
  @media (max-device-width: 812px) {
    body {
      max-width: 100vw;
      line-height: 1.4em;
    }
    h1 {
      /*font-size: 1.4em;*/
      /*line-height: 1em;*/
    }
    img {
      width: 100%
    }
  }
  </style>
  <link rel=stylesheet href=/assets/diff-styles.css />
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-51391788-2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-51391788-2');
  </script>
</head>
<body class="f9 b9">
  <div class="title"><a href="/">Dave Normington</a></div>
  <p class="description">Lead Software Engineer at <a href="https://www.arcadiagroup.co.uk/">Arcadia</a></p>
  <pre><span class="bold">diff --git a/markdown/designing-a-query-lang.md b/markdown/designing-a-query-lang.md
new file mode 100644</span>
<span class="bold">index 0000000..3143523</span>
<span class="bold">--- /dev/null</span>
<span class="bold">+++ b/markdown/designing-a-query-lang.md</span>
<span class="f6">@@ -0,0 +1,63 @@</span>
<span class="f2">+# Desiging a query language</span>
<span class="f2">+</span>
<span class="f2">+10 Aug 2018</span>
<span class="f2">+</span>
<span class="f2">+A little over a year ago, I helped to design a query language (similar to SQL) for users
+of a wealth management product we were building. I worked on the initial language design
+and the front end experience while Bruno Felix built the final version and hooked it up to
+our client's Java backend.</span>
<span class="f2">+</span>
<span class="f2">+The potential users of the product would not be DBAs, programmers or even be particularly</span>
<span class="f2">+computer savvy. Their day to day tools included Microsoft Excel and had grown so used</span>
<span class="f2">+to it that, during our first round of user testing, some were reluctant to use anything else.
+Therefore the product, including the query language, had to be simple enough for them to</span>
<span class="f2">+understand and be picked up quickly.</span>
<span class="f2">+</span>
<span class="f2">+The dataset we were querying had values that changed over time as the records pointed to</span>
<span class="f2">+market positions whose value changed as the market did. Therefore a &quot;SELECT&quot; query</span>
<span class="f2">+didn't return a single result but instead created a stream of results that we would need</span>
<span class="f2">+to continually render.</span>
<span class="f2">+</span>
<span class="f2">+I wanted to transpile this query language into EPL to run in the Esper engine.</span>
<span class="f2">+I was unfamilar with Esper and EPL and if you are also, think of Esper as the database</span>
<span class="f2">+working on inbound streams of data and EPL is the query language to form an outbound stream of results.
+These were the tools being used by our client at the time.</span>
<span class="f2">+</span>
<span class="f2">+I prototyped the query language in Javascript in a day or so, which pulled data from a randomly generated dataset.
+The aim was to see if I could write a simple query language, familarise myself with lexing, parsing, etc,</span>
<span class="f2">+and present it to the client as the main interface of the product which their users will interact with.</span>
<span class="f2">+</span>
<span class="f2">+An example query may have been:</span>
<span class="f2">+</span>
<span class="f2">+```</span>
<span class="f2">+get crypto where price &gt; 200m</span>
<span class="f2">+```</span>
<span class="f2">+</span>
<span class="f2">+This would roughly translate to:</span>
<span class="f2">+</span>
<span class="f2">+```</span>
<span class="f2">+# Aggregate the position records (sum) and filter (where) the aggregates by those greater than 200 million.</span>
<span class="f2">+SELECT * from (SELECT SUM(price) from Positions) where price &gt; 200000000</span>
<span class="f2">+```</span>
<span class="f2">+</span>
<span class="f2">+We knew ahead of time that there was a limited number of columns and we knew the</span>
<span class="f2">+types of the columns which meant that we could infer the column aggregate function (sum, concat etc).</span>
<span class="f2">+That meant less syntax for the end user to learn, win!</span>
<span class="f2">+</span>
<span class="f2">+It occurred to me that the user would probably want a lot of the same tools that developers use everyday</span>
<span class="f2">+to help them construct their queries, such as syntax highlighting and autocompletion.</span>
<span class="f2">+However we didn't want the network latency to hinder the user experience; who wants to</span>
<span class="f2">+wait for a round trip before knowing there's a syntax error! The final query language was ยง</span>
<span class="f2">+written using ANTLR which we'd use to generate the Java parser. Luckily, ANTLR also</span>
<span class="f2">+supports generating Javascript which we could use to parse the statements on the</span>
<span class="f2">+client, check for syntax errors, use the AST (Abstract Syntax Tree) for highlighting</span>
<span class="f2">+and for autocompletion.</span>
<span class="f2">+</span>
<span class="f2">+Unfortunately I moved on from Signal Noise before seeing the final version. Although it was fun</span>
<span class="f2">+working on context free grammars and mixing more computer science stuff with software engineering,</span>
<span class="f2">+I have my doubts as to how successful the query language will be. Thinking of similar</span>
<span class="f2">+implementations such as Jira's JQL, I don't know how well used or liked it is verus filters</span>
<span class="f2">+and drop down menus. The client even said that they had tried a query language before</span>
<span class="f2">+without much success.</span>
<span class="f2">+</span>
<span class="f2">+Still I learned a lot and had fun working with Bruno et al so for me it was a great success.</span></pre>
  <!-- {{footer}} -->
</body>
</html>
