<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>blog</title>
  <style>
  html { font-size: 12px; }
  body {
    font-family: Courier;
    font-size: 1em;
    line-height: 1.2em;
    padding: 20px;
    background: #fcfcfc;
    color: #333;
    max-width: 500px;
    margin: 0 auto;
    box-sizing: content-box;
    word-wrap: break-word;
  }
  h1 { font-size: 2em; line-height: 1em; font-weight: bold; }
  li { margin: 1em 0; }
  .title a {
    font-size: 2.5em;
    line-height: 1em;
    font-weight: bold;
    color: inherit;
  }
  .description {
    font-size: 0.9em;
    font-style: italic;
    line-height: 0.3em;
    margin-bottom: 20px;
  }
  pre {
    border: 1px solid #ccc;
    border-radius: 5px;
    padding: 15px;
    background: #f0f0f0;
    overflow: scroll;
    font-family: Courier;
    font-size: 1em;
  }
  pre code {
    padding: 0;
  }
  code {
    font-family: Courier;
    font-size: 1em;
    background: #f0f0f0;
    padding: 3px 5px;
  }
  blockquote {
    border-left: 5px solid #ddd;
    padding-left: 20px;
    margin: 40px 10px;
    font-style: italic;
  }
  @media (max-device-width: 812px) {
    body {
      max-width: 100vw;
      font-size: 1.4em;
      line-height: 1.5em;
    }
    h1 {
      /*font-size: 1.4em;*/
      /*line-height: 1em;*/
    }
    img {
      width: 100%
    }
  }
  </style>
  <link rel=stylesheet href=/assets/diff-styles.css />
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-51391788-2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-51391788-2');
  </script>
</head>
<body class="f9 b9">
  <div class="title"><a href="/">Dave Normington</a></div>
  <p class="description">Lead Software Engineer at <a href="https://www.arcadiagroup.co.uk/">Arcadia</a></p>
  <pre><span class="bold">diff --git a/markdown/unit-testing-with-mocks.md b/markdown/unit-testing-with-mocks.md
index 274d041..ee3c0fa 100644</span>
<span class="bold">--- a/markdown/unit-testing-with-mocks.md</span>
<span class="bold">+++ b/markdown/unit-testing-with-mocks.md</span>
<span class="f6">@@ -1,6 +1,52 @@</span>
 # Unit Testing with Mocks
 
<span class="f1">-At [Assert(js)](https://www.assertjs.com/) 2018, Justin Searls ([@searls](https://twitter.com/searls)) gave a great and balanced talk about the value of mocking. Stop reading. Watch the talk. All of it. Or read my [Too long didn't watch](#) summary for the more impatient among you but the talk is much more entertaining.
</span><span class="f2">+16 June 2018</span>
 
<span class="f1">-[![&quot;Don't Mock Me&quot; by Justin Searls at Assert\(js\) 2018](https://i.ytimg.com/vi/Af4M8GMoxi4/hqdefault.jpg?sqp=-oaymwEZCNACELwBSFXyq4qpAwsIARUAAIhCGAFwAQ==&amp;rs=AOn4CLCdoQgCsfIPHzbmmx2NGN-xGw7kSg)](https://youtu.be/Af4M8GMoxi4)</span>
<span class="f2">+At [Assert(js)](https://www.assertjs.com/) 2018, Justin Searls ([@searls](https://twitter.com/searls)) gave</span>
<span class="f2">+a great and balanced talk about the value of mocking. Stop reading. Watch the talk.</span>
<span class="f2">+All of it. Or read my [Too long didn't watch](/posts/dont-mock-me-summary/head) summary for the more impatient among you</span>
<span class="f2">+but the talk is much more entertaining.</span>
 
<span class="f2">+&lt;div style=&quot;text-align: center&quot;&gt;[![&quot;Don't Mock Me&quot; by Justin Searls at Assert\(js\) 2018](https://i.ytimg.com/vi/Af4M8GMoxi4/hqdefault.jpg?sqp=-oaymwEZCNACELwBSFXyq4qpAwsIARUAAIhCGAFwAQ==&amp;rs=AOn4CLCdoQgCsfIPHzbmmx2NGN-xGw7kSg)](https://youtu.be/Af4M8GMoxi4)&lt;/div&gt;</span>
<span class="f2">+</span>
<span class="f2">+Before Justin's talk I fell into the &quot;avoid mocking unless absolutely necessary&quot; camp.</span>
<span class="f2">+I didn't consider the pros and cons of either approach. I didn't think of the scenarios</span>
<span class="f2">+in which using mocks would actually improve my tests.</span>
<span class="f2">+</span>
<span class="f2">+I had read Martin Fowler's [UnitTest](https://martinfowler.com/bliki/UnitTest.html) article</span>
<span class="f2">+and often sited it, refering to the benefit of &quot;socialable&quot; unit tests. These are closer</span>
<span class="f2">+to the real world usage of the units and were blackbox tests meaning that your tests weren't</span>
<span class="f2">+aware of the implementation details. This meant that I could refactor the unit without</span>
<span class="f2">+having to change my tests at the same time.</span>
<span class="f2">+</span>
<span class="f2">+&lt;div style=&quot;text-align: center&quot;&gt;&lt;img alt=&quot;Module A depends on B which depends on C and each has it's own socialable unit test suite&quot; src=&quot;/assets/a-b-c-with-tests.png&quot; width=&quot;400px&quot; /&gt;&lt;/div&gt;</span>
<span class="f2">+</span>
<span class="f2">+But there were some pain points. If I tested `A` that depended on `B` which in turn also</span>
<span class="f2">+depended on `C`, my test would be covering `B` and `C`. But `B` also had it's own unit tests</span>
<span class="f2">+and those also covered `C`. And finally `C` would have it's own unit tests. It felt that in some cases,</span>
<span class="f2">+despite the tests being at different levels of abstraction, that some cases were repeated throughout.</span>
<span class="f2">+</span>
<span class="f2">+There are also the times that when I changed the behaviour of `C`, then tests for `A` and `B` would also fail.</span>
<span class="f2">+Sometimes I would have to modify `A` and `B` to pass new arguments along but not as often as you might think.</span>
<span class="f2">+There is this subtle coupling between the tests of `A` + `B` and the behaviour of `C`. Even though the tests don't</span>
<span class="f2">+reference the implementation of `C`, I have to change the tests when `C` changes.</span>
<span class="f2">+</span>
<span class="f2">+&lt;div style=&quot;text-align: center&quot;&gt;&lt;img alt=&quot;Module A depends on B which depends on C2, unit tests for A and B are failing because C's behaviour has changed&quot; src=&quot;/assets/a-b-c2-failing-tests.png&quot; width=&quot;400px&quot; /&gt;&lt;/div&gt;</span>
<span class="f2">+</span>
<span class="f2">+That starts to sound like a violation of the Single Responsibility Principle (SRP). Perhaps the cases I'm testing in `A` and `B`</span>
<span class="f2">+should really live in the test suite for `C`. Then the tests in `A` could simply check that `B` was called</span>
<span class="f2">+by using a mock. Likewise in the tests for `B` a mock can help to verify that `C` is being called correctly.</span>
<span class="f2">+</span>
<span class="f2">+&lt;div style=&quot;text-align: center&quot;&gt;&lt;img alt=&quot;Module A depends on B which depends on C2, unit tests for A and B are failing because C's behaviour has changed&quot; src=&quot;/assets/a-b-c-with-mocks.png&quot; width=&quot;400px&quot; /&gt;&lt;/div&gt;</span>
<span class="f2">+</span>
<span class="f2">+What are the benefits of this approach?</span>
<span class="f2">+</span>
<span class="f2">+- The duplicate test cases go away and will only exist in the test suite for `C`.</span>
<span class="f2">+- The tests for `A` and `B` become much simpler, as they only specify the relationships between the unit under test and it's dependencies.</span>
<span class="f2">+- When `C`'s behaviour changes `A` and `B`'s tests won't need to change (unless their contracts change)</span>
<span class="f2">+- The other unspoken dependencies of `A` and `B` can also be mocked out, so we get the above benefits again for these other modules.</span>
<span class="f2">+</span>
<span class="f2">+What are the drawbacks?</span>
<span class="f2">+</span>
<span class="f2">+- The tests for `A` and `B` are now more coupled to the unit they are testing. Refactoring them may require changing the tests also.</span>
<span class="f2">+- There is now no unit test the covers the real path through the three modules. To have the same level of confidence that the code works correctly, we require another test to cover the full path.</span></pre>
  <!-- {{footer}} -->
</body>
</html>
